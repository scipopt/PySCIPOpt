version: '{build}'

branches:
  only:
  - master

environment:
  SCIPOPTDIR: C:\scipoptdir
  password:
    secure: HEa8MAJyyfSv33snyK3Gleflk9SIfZBxbnTiS39hlWM=

  matrix:
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
      PYTHON: C:\Python27-x64
      PIP: C:\Python27-x64\Scripts\pip
      PYTEST: C:\Python27-x64\Scripts\pytest
      TWINE: C:\Python27-x64\Scripts\twine
      INCLUDE_REQUIRED: true
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
      PYTHON: C:\Python35-x64
      PIP: C:\Python35-x64\Scripts\pip
      PYTEST: C:\Python35-x64\Scripts\pytest
      TWINE: C:\Python35-x64\Scripts\twine
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
      PYTHON: C:\Python36-x64
      PIP: C:\Python36-x64\Scripts\pip
      PYTEST: C:\Python36-x64\Scripts\pytest
      TWINE: C:\Python36-x64\Scripts\twine


install:
  - ps: Install-Package -Scope CurrentUser -Force 7Zip4PowerShell -Source PSGallery
  - ps: wget http://scip.zib.de/download/release/scip-4.0.1.tgz -outfile scip.tgz
  - ps: wget http://soplex.zib.de/download/release/soplex-3.0.1.tgz -outfile soplex.tgz
  - ps: Expand-7Zip scip.tgz .
  - ps: Expand-7Zip scip.tar .
  - ps: Expand-7Zip soplex.tgz .
  - ps: Expand-7Zip soplex.tar .
  - cmake -Bsoplex-build -Hsoplex-3.0.1 -DCMAKE_INSTALL_PREFIX=%SCIPOPTDIR% -DCMAKE_GENERATOR_PLATFORM=x64
  - cmake --build soplex-build --config Release --target INSTALL
  - cmake -Bscip-build -Hscip-4.0.1 -DCMAKE_INSTALL_PREFIX=%SCIPOPTDIR% -DCMAKE_GENERATOR_PLATFORM=x64
  - cmake --build scip-build --config Release --target INSTALL
  - set PATH=%SCIPOPTDIR%\bin;%PYTHON%;%PATH%
  - if [%INCLUDE_REQUIRED%]==[true] copy .\VC9-include\* %SCIPOPTDIR%\include
  - cmd: "%PIP% install cython networkx pytest wheel twine"

build_script:
  - python setup.py install

test_script:
  - cmd: "%PYTEST% tests"

artifacts:
  - path: dist\*

after_test:
  - cmd: "echo [pypi] > %USERPROFILE%\\.pypirc"
  - cmd: "echo username: pyscipopt >> %USERPROFILE%\\.pypirc"
  - cmd: "echo password: %password% >> %USERPROFILE%\\.pypirc"
  - python setup.py bdist_wheel

on_success:
  - cmd: "if [%APPVEYOR_REPO_TAG%]==[true] %TWINE% upload dist\\*.whl"
